{% extends 'canteen/manage_base.html' %}

{% load static %}
{% load humanize %}
{% load thumbnail %}

{% block title %}Management of the Dishes{% endblock %}

{% block header %}Management of the Dishes{% endblock %}

{% block style %}
<style>
    .dishes-flex {
        display: flex;
    }

    .dish-controls {
        display: flex;
        justify-content: right;
        align-items: center;
        border-left: 1px solid #4CAF50;
    }

    .dish-info {
        display: flex;
    }

    .dish-image-cont {
        display: flex;
        justify-content: right;
        flex-direction: column;
        border-right: 1px solid #4CAF50;
    }

    .dish-controls>* {
        margin: 5px;
    }

    img {
        width: 200px;
        height: 100%;
        object-fit: cover;
        border-radius: 8px 0px 0px 8px;
    }

    #buttons {
        text-align: right;
    }

    @media (max-width: 600px) {

        .dishes-flex,
        .dish-info {
            flex-direction: column;
        }

        .dish-controls {
            justify-content: center;
            align-items: center;
            border-top: 1px solid #4CAF50;
            border-left: none;
        }

        .dish-image-cont {
            border-right: none;
            border-bottom: 1px solid #4CAF50;
        }

        img {
            width: 100%;
            height: 150px;
            border-radius: 8px 8px 0px 0px;
        }
    }

    @media (max-width:992px) and (min-width:601px) {
        .dish-controls>* {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 40px;
            height: 40px;
        }
    }
</style>
{% endblock %}

{% block content %}
<article class="w3-container w3-margin-top w3-padding-top">
    <div class="w3-content">
        {% if dishes %}
        <h2><i class="fa fa-drumstick-bite"></i> These are the dishes for today.</h2>
        {% for d in dishes %}
        <div class="dishes-flex w3-card-4 w3-border w3-border-green w3-margin-bottom w3-round-large">
            <div class="dish-image-cont">
                {% thumbnail d.photo "150x150" crop="center" as im %}
                <img src="{{ im.url }}">
                {% endthumbnail %}
            </div>
            <div class="dish-info" style="flex-grow: 8">
                <div class="w3-padding" style="flex-grow: 8">
                    <h3>{{ d.name|title }}</h3>
                    <p>It costs <span class="w3-tag w3-round-xxlarge w3-light-green">â‚± {{ d.price|intcomma }}</span>.
                        {{ d.description }}</p>
                    {% if d.sold_out %}
                    <p class="w3-pink w3-small w3-tag w3-round-large">Sold out</p>
                    {% else %}
                    <p class="w3-green w3-small w3-tag w3-round-large">Not sold out</p>
                    {% endif %}
                    {% if d.everyday %}
                    <p class="w3-green w3-small w3-tag w3-round-large">Everyday dish</p>
                    {% else %}
                    <p class="w3-pink w3-small w3-tag w3-round-large">Not an everyday dish</p>
                    {% endif %}
                </div>
                <div class="dish-controls">
                    <a href="{% url 'canteen:edit' d.id %}" class="w3-button w3-blue w3-round-xxlarge"><i
                            class="fas fa-pencil-alt"></i> <span class="w3-hide-medium">Edit</span></a>
                    <button class="w3-button w3-red w3-round-xxlarge" onclick="prepareForDeleting('{{ d.id }}')"><i
                            class="fas fa-trash-alt"></i> <span class="w3-hide-medium">Delete</span></button>
                </div>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <h2>The canteen is not yet cooking anything.</h2>
        <p>You can add a dish by clicking the green button.</p>
        {% endif %}
        <div class="w3-container">
            <hr class="w3-margin-top" />
            <a href="{% url 'canteen:create' %}" class="w3-button w3-round-xxlarge w3-green w3-right"><i
                    class="fa fa-plus"></i> Add dish</a>
        </div>
    </div>
</article>

<div id="confirm" class="w3-modal">
    <div
        class="w3-cotainer w3-animate-top w3-padding w3-border w3-border-red w3-topbar w3-leftbar w3-rightbar w3-bottombar w3-modal-content w3-round-xlarge">
        <h2 class="w3-text-red"><i class="fas fa-exclamation-triangle"></i> Confirmation</h2>
        <p>Are you sure that you want to delete this dish? Doing so will, of couse, delete it completely. Orders of this
            dish will be deleted as well, thus making the report unreliable.</p>
        <p id="buttons">
            <button class="w3-green w3-button w3-round-xxlarge" onclick="$('#confirm').slideUp()">
                <i class="fas fa-times-circle"></i> No</button>
            <button class="w3-red w3-button w3-round-xxlarge" onclick="deleteCompletely()">
                <i class="fas fa-check-circle"></i> Yes</button>
        </p>
    </div>
</div>

<script>
    var dishId;

    function prepareForDeleting(id) {
        dishId = id;
        $('#confirm').show();
    }

    function deleteCompletely() {
        $.get('/api-delete-dish/' + dishId + '/');
        dishId = '';
        $('#confirm').slideUp();
        location.reload(true);
    }
</script>
{% endblock %}