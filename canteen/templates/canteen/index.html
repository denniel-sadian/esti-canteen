{% load static %}
{% load humanize %}

<!DOCTYPE html>
<html>

<head>
    <title>ESTI Canteen Online Ordering System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="google-site-verification" content="FTZWO1Qq5IIiyHFq8P2FnK9nLlSAl2Ftgjtc8ppr5Is" />

    {% with 'https://esticanteen.herokuapp.com' as domain %}
    <meta name="og:title" content="ESTI Canteen Ordering System" />
    <meta name="twitter:title" content="ESTI Canteen Ordering System" />
    <meta name="description" content="Where you can find the best delicacies." />
    <meta name="twitter:description" content="Where you can find the best delicacies." />
    <meta name="og:description" content="Where you can find the best delicacies." />
    <meta name="twitter:image" content="{{ domain }}{% static 'canteen/bg.jpg' %}" />
    <meta name="og:image" content="{{ domain }}{% static 'canteen/bg.jpg' %}" />
    {% endwith %}

    <meta name="google-site-verification" content="8KRj0scCxCiNcxjPWlApSIIXTOipt2bT3WcUeVsqv80" />
    <link rel="stylesheet" href="{% static 'canteen/w3.css' %}" />
    <link rel="icon" href="{% static 'canteen/esti_icon.png' %}" type="image/x-icon" />
    <script rel="script" src="{% static 'canteen/jquery.min.js' %}"></script>
    <script rel="script" src="{% static 'canteen/reconnecting-websocket.min.js' %}"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
        integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto+Slab&display=swap);
        @import url(https://fonts.googleapis.com/css?family=Nunito);

        html,
        body {
            height: 100%;
            padding: 0px;
            margin: 0px;
        }

        .linear-bg {
            background: linear-gradient(to right, #2196F3, violet);
        }

        .linear-bg:hover {
            background: #c6c6c6;
        }

        header {
            height: 100%;
            background: url("{% static 'canteen/canteen-bg.jpg' %}") no-repeat center fixed;
            background-size: cover;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .grid-cont {
            display: grid;
            grid-template-columns: 2fr 3fr;
            grid-template-areas:
                "logo text"
                "bttn bttn";
            padding-left: 100px;
            padding-right: 100px;
        }

        .logo {
            grid-area: logo;
            align-self: center;
            justify-self: end;
        }

        .text {
            grid-area: text;
            align-self: center;
            justify-self: start;
        }

        .bttn {
            grid-area: bttn;
            align-self: start;
            justify-self: center;
            width: 100%;
            text-align: center;
        }

        .bttn a {
            width: 100%;
            max-width: 25%;
        }

        header h1 {
            line-height: 1.32em;
            font-family: 'Roboto Slab', serif;
            font-weight: bolder;
        }

        header h1 span,
        header p span {
            background: rgba(0, 0, 0, 0.589);
        }

        .white-art {
            height: 80%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .white-art>div {
            display: grid;
            grid-template-areas:
                "text image";
            text-align: center;
        }

        .white-art>div img {
            grid-area: image;
            justify-self: center;
        }

        .white-art>div h1 {
            grid-area: text;
            align-self: center;
            font-family: "Nunito";
            font-weight: 800;
        }

        .served,
        .ready,
        .notReady {
            display: flex;
            align-items: center;
            text-align: left;
            margin-bottom: 8px;
        }

        .served i,
        .ready i,
        .notReady i {
            padding-right: 16px;
        }

        .served {
            background: #ddffdd;
            border-left: 3px solid #4CAF50;
        }

        .ready {
            background: #ffffcc;
            border-left: 3px solid #d2be0e;
        }

        .notReady {
            background: #ffdddd;
            border-left: 3px solid #f44336;
        }

        .bg-parallax {
            background: url("{% static 'canteen/detail-bg.jpg' %}") fixed;
            height: 80%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-areas:
                "image text";
        }

        .bg-parallax>div {
            grid-area: text;
            justify-self: center;
            align-self: center;
            padding: 30px 30px 30px 0px;
            width: 100%;
            height: 100%;
        }

        .bg-parallax>div>div {
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            padding: 16px;
        }

        .bg-parallax h1 {
            font-family: "Nunito";
            font-weight: 800;
            text-align: center;
            line-height: 1.4em;
        }

        .bg-parallax img {
            width: 400px;
            height: auto;
            grid-area: image;
            justify-self: center;
            align-self: center;
        }

        @media (max-width:768px) {

            /* Small */
            header h1 {
                font-size: 50px;
            }

            .grid-cont {
                grid-template-areas:
                    "logo logo"
                    "text text"
                    "bttn bttn";
                padding-left: 10px;
                padding-right: 10px;
            }

            .logo,
            .text,
            .bttn {
                justify-self: center;
                text-align: center;
            }

            .bttn a {
                width: 100%;
                max-width: 50%;
            }

            #logo {
                width: 140px;
                height: 140px;
            }

            .white-art>div {
                grid-template-areas:
                    "image"
                    "text";
            }

            .white-art>div img {
                width: 300px;
            }

            .white-art>div h1,
            .bg-parallax h1 {
                font-size: 30px !important;
            }

            .bg-parallax>div {
                padding: 0px;
            }

            .bg-parallax>div>div {
                background: none;
            }

            .bg-parallax>div>div span {
                background: rgba(0, 0, 0, 0.589);
                color: white;
            }

            .bg-parallax {
                grid-template-columns: none;
                grid-template-areas:
                    "image"
                    "text";
            }

            .bg-parallax img {
                width: 200px;
                align-self: flex-end;
            }

            .bg-parallax>div>div {
                align-items: flex-start;
            }
        }

        @media (max-width:992px) and (min-width:601px) {

            /* Medium */
            header h1 {
                font-size: 70px;
            }

            .grid-cont {
                grid-template-areas:
                    "logo logo"
                    "text text"
                    "bttn bttn";
                padding-left: 10px;
                padding-right: 10px;
            }

            .logo {
                justify-self: center;
            }

            .text {
                text-align: center;
            }

            .bttn a {
                width: 100%;
                max-width: 30%;
            }

            #logo {
                width: 150px;
                height: 150px;
            }

            .white-art>div {
                grid-template-areas:
                    "image"
                    "text";
            }

            .white-art>div img {
                width: 350px;
            }

            .bg-parallax>div {
                padding: 0px;
            }

            .bg-parallax>div>div {
                background: none;
            }

            .bg-parallax>div>div span {
                background: rgba(0, 0, 0, 0.589);
                color: white;
            }

            .bg-parallax {
                grid-template-columns: none;
                grid-template-areas:
                    "image"
                    "text";
            }

            .bg-parallax img {
                width: 300px;
                align-self: flex-end;
            }

            .bg-parallax>div>div {
                align-items: flex-start;
            }
        }

        @media (min-width:993px) {

            /* Large */
            header h1 {
                font-size: 90px;
            }
        }
    </style>
</head>

<body>

    {% include 'canteen/nav.html' %}

    <header class="w3-animate-opacity">
        <div class="grid-cont">
            <div class="logo">
                <img id="logo" src="{% static 'canteen/esti_square.png' %}" width="350" height="350" />
            </div>
            <div class="text">
                <h1 class="w3-text-light-green"><span>Welcome to the ESTI Canteen!</span></h1>
                <p class="w3-large w3-text-white"><span>Where you can find the best delicacies.</span>
                </p>
            </div>
            <div class="bttn">
                <a href="{% url 'canteen:menu' %}#article"
                    class="w3-button w3-padding w3-round-xxlarge linear-bg w3-text-white">
                    <i class="fas fa-clipboard-list"></i> See the menu</a>
            </div>
        </div>
    </header>

    <article class="white-art w3-white w3-container">
        <div class="w3-content">
            <img src="{% static 'canteen/burger.jpg' %}" width="400" height="auto" alt="burger">
            <h1>We cook with our best experience while maintaining the sparkling cleanliness.</h1>
        </div>
    </article>

    <article class="bg-parallax">
        <img src="{% static 'canteen/coffee.png' %}" width="400" height="auto" alt="coffee">
        <div>
            <div>
                <h1><span>At our canteen, we greet you as warm as a cup of coffee! You'll always feel
                        comfortable.</span></h1>
            </div>
        </div>
    </article>

    {% if request.session.orders %}
    <article class="w3-container" id="orders-on-device">
        <div class="w3-content w3-white w3-round" style="margin-top: 50px; margin-bottom: 50px;">
            <h3><i class="fas fa-clipboard-list"></i> These are the orders from this device.</h3>
            <p class="w3-small">The orders made from this device are only displaying here and on the real-time admin
                page. Please do not close this tab and your browser if you want to keep track of the orders' status. The
                orders cannot be edited by you. Only the admins have the authorization to modify them. You,
                however, can ask the admins to change it for you when you're at the canteen already.</p>
            <p class="w3-center w3-opacity" id="spinner"><i class="fas fa-spinner w3-spin"></i> Loading updates...</p>
            <div id="orders">
            </div>
        </div>
        <script>
            var protocol = location.protocol == 'https:' ? 'wss://' : 'ws://';
            var reportSocket = new ReconnectingWebSocket(
                protocol + location.host +
                '/ws/update/');
            var orders = $('#orders');
            function structureOrders() {
                var ul = $('<ul class="w3-ul"></ul>');
                $.get("{% url 'canteen:json-customer-orders' %}", function (data, status) {
                    if (status == 'success') {
                        console.log('Updating the orders...');
                        if (!(data.length)) location.reload();
                        for (var i in data) {
                            if (data[i].served) {
                                ul.append($(
                                    '<li class="served w3-round"><i class="fas fa-check-circle w3-text-green"></i> <span>The order of ' + data[i].name + ', which was ' + data[i].dish.name + ', has been served already.</span></li>'
                                ));
                            } else {
                                if (data[i].ready) {
                                    ul.append($(
                                        '<li class="ready w3-round"><i class="fas fa-exclamation-circle w3-text-yellow"></i> <span>The order of ' + data[i].name + ", which is " + data[i].dish.name + ' with the order quantity of ' + data[i].dish.count + ' and priced as ₱' + data[i].dish.price + ' is now ready to be served.</span></li > '
                                    ));
                                } else {
                                    ul.append($(
                                        '<li class="notReady w3-round"><i class="fas fa-times-circle w3-text-red"></i> <span>The order of ' + data[i].name + ", which is " + data[i].dish.name + ' with the order quantity of ' + data[i].dish.count + ' and priced as ₱' + data[i].dish.price + ' is not yet ready.</span></li > '
                                    ));
                                }
                            }
                        }
                    }
                });
                orders.html(ul);
                $('#spinner').slideUp();
            }

            $(document).ready(function () {
                setInterval(location.reload, 300000);
                structureOrders();
                reportSocket.onmessage = function (e) {
                    $('#spinner').slideDown();
                    structureOrders();
                };
            })
        </script>
    </article>
    {% endif %}

    {% include 'canteen/footer.html' with canShare=True %}

</body>

</html>