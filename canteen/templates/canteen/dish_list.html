{% load static %}
{% load humanize %}

<!DOCTYPE html>
<html>

<head>
    <title>ESTI Canteen - Menu</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="google-site-verification" content="FTZWO1Qq5IIiyHFq8P2FnK9nLlSAl2Ftgjtc8ppr5Is" />

    {% with 'https://esticanteen.herokuapp.com' as domain %}
    <meta name="og:title" content="ESTI Canteen Ordering System" />
    <meta name="twitter:title" content="ESTI Canteen Ordering System" />
    <meta name="description" content="Where you can find the best delicacies." />
    <meta name="twitter:description" content="Where you can find the best delicacies." />
    <meta name="og:description" content="Where you can find the best delicacies." />
    <meta name="twitter:image" content="{{ domain }}{% static 'canteen/bg.jpg' %}" />
    <meta name="og:image" content="{{ domain }}{% static 'canteen/bg.jpg' %}" />
    {% endwith %}

    <meta name="google-site-verification" content="8KRj0scCxCiNcxjPWlApSIIXTOipt2bT3WcUeVsqv80" />
    <link rel="stylesheet" href="{% static 'canteen/w3.css' %}" />
    <link rel="icon" href="{% static 'canteen/esti_icon.png' %}" type="image/x-icon" />
    <script rel="script" src="{% static 'canteen/jquery.min.js' %}"></script>
    <script rel="script" src="{% static 'canteen/reconnecting-websocket.min.js' %}"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
        integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto+Slab&display=swap);

        html,
        body {
            height: 100%;
            padding: 0px;
            margin: 0px;
        }

        body {
            background: url("{% static 'canteen/home-bg.jpg' %}");
        }

        .linear-bg {
            background: linear-gradient(to right, #2196F3, violet);
        }

        .linear-bg:hover {
            background: #c6c6c6;
        }

        header {
            height: 100%;
            background: url("{% static 'canteen/canteen-bg.jpg' %}") no-repeat center fixed;
            background-size: cover;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .grid-cont {
            display: grid;
            grid-template-columns: 2fr 3fr;
            grid-template-areas:
                "logo text"
                "bttn bttn";
            padding-left: 100px;
            padding-right: 100px;
        }

        .logo {
            grid-area: logo;
            align-self: center;
            justify-self: end;
        }

        .text {
            grid-area: text;
            align-self: center;
            justify-self: start;
        }

        .bttn {
            grid-area: bttn;
            align-self: start;
            justify-self: center;
            width: 100%;
            text-align: center;
        }

        .bttn a {
            width: 100%;
            max-width: 25%;
        }

        header h1 {
            line-height: 1.32em;
            font-family: 'Roboto Slab', serif;
            font-weight: bolder;
        }

        header h1 span,
        header p span {
            background: rgba(0, 0, 0, 0.589);
        }

        .served,
        .ready,
        .notReady {
            display: flex;
            align-items: center;
            text-align: left;
            margin-bottom: 8px;
        }

        .served i,
        .ready i,
        .notReady i {
            padding-right: 16px;
        }

        .served {
            background: #ddffdd;
            border-left: 3px solid #4CAF50;
        }

        .ready {
            background: #ffffcc;
            border-left: 3px solid #d2be0e;
        }

        .notReady {
            background: #ffdddd;
            border-left: 3px solid #f44336;
        }

        @media (max-width:768px) {

            /* Small */
            header h1 {
                font-size: 50px;
            }

            .grid-cont {
                grid-template-areas:
                    "logo logo"
                    "text text"
                    "bttn bttn";
                padding-left: 10px;
                padding-right: 10px;
            }

            .logo,
            .text,
            .bttn {
                justify-self: center;
                text-align: center;
            }

            .bttn a {
                width: 100%;
                max-width: 50%;
            }

            #logo {
                width: 140px;
                height: 140px;
            }

            footer h1 {
                font-size: 25px;
            }
        }

        @media (max-width:992px) and (min-width:601px) {

            /* Medium */
            header h1 {
                font-size: 70px;
            }

            .grid-cont {
                grid-template-areas:
                    "logo logo"
                    "text text"
                    "bttn bttn";
                padding-left: 10px;
                padding-right: 10px;
            }

            .logo {
                justify-self: center;
            }

            .text {
                text-align: center;
            }

            .bttn a {
                width: 100%;
                max-width: 30%;
            }

            #logo {
                width: 150px;
                height: 150px;
            }
        }

        @media (min-width:993px) {

            /* Large */
            header h1 {
                font-size: 90px;
            }
        }

        /* DISHES */

        @import url(https://fonts.googleapis.com/css?family=Sofia);

        #dishes {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        #dishes>div {
            width: 33%;
        }

        .dish-cont {
            position: relative;
            margin: 10px;
            border-radius: 16px;
            transition: 0.3s;
            animation: move-up;
        }

        .dish-cont:hover {
            cursor: pointer;
            opacity: 0.5;
            bottom: 5px;
        }

        .dish-cont img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 16px;
            border: 3px solid #ff9800;
        }

        .dish-cont div.dish-title {
            position: absolute;
            bottom: 0px;
            text-align: center;
            color: white;
            width: 100%;
            border-radius: 0px 0px 12px 12px;
            padding: 8px;
            background: linear-gradient(to right, #ff9800, #9c27b0);
        }

        .dish-cont div h4 {
            line-height: 1.5em;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
            font-family: 'Sofia';
            font-weight: 800;
            font-size: 24px;
        }

        .sold-out-tag {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            background: none !important;
            color: white;
        }

        .sold-out-tag h1 {
            border-radius: 10px;
            padding: 8px;
            background: #f44336ed;
            z-index: 1;
        }

        .price {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff9800;
            font-family: 'Sofia';
            font-weight: 600;
        }

        @media screen and (max-width: 750px) {
            #dishes>div {
                width: 50%;
            }
        }

        @media screen and (max-width: 550px) {
            #dishes>div {
                width: 100%;
            }

            .dish-cont {
                margin-left: unset;
                margin-right: unset;
            }

            .dish-cont img {
                height: 250px;
            }
        }
    </style>
</head>

<body>

    {% include 'canteen/nav.html' %}

    <header class="w3-animate-opacity">
        <div class="grid-cont">
            <div class="logo">
                <img id="logo" src="{% static 'canteen/esti_square.png' %}" width="350" height="350" />
            </div>
            <div class="text">
                <h1 class="w3-text-light-green"><span>Welcome to the ESTI Canteen!</span></h1>
                <p class="w3-large w3-text-white"><span>Where you can find the best delicacies.</span>
                </p>
            </div>
            <div class="bttn">
                <a href="#article" class="w3-button w3-padding w3-round-xxlarge linear-bg w3-text-white">
                    <i class="fas fa-clipboard-list"></i> See the menu</a>
            </div>
        </div>
    </header>

    <article id="article" class="w3-container w3-padding-32 w3-margin w3-animate-opacity">
        <div class="w3-content">
            {% if dishes %}
            <h2><i class="fas fa-clipboard-list"></i> Our menu for today!</h2>
            <div id="dishes">
                {% for dish in dishes %}
                <div>
                    <div onclick="location.assign('{% url 'canteen:not-api-dish-detail' dish.id %}')"
                        class="dish-cont w3-animate-zoom w3-card-4">
                        {% if dish.sold_out %}
                        <div class="sold-out-tag">
                            <h1>SOLD OUT</h1>
                        </div>
                        {% endif %}
                        <img src="{{ dish.photo.url }}" class="w3-image {% if dish.sold_out %}w3-opacity{% endif %}"
                            alt="{{ dish.name|title }}">
                        <span
                            class="w3-card-4 w3-tag w3-round-xxlarge price {% if dish.sold_out %}w3-opacity{% endif %}">â‚±
                            {{ dish.price|intcomma }}</span>
                        <div class="dish-title {% if dish.sold_out %}w3-opacity{% endif %}">
                            <h4>{{ dish.name|title }}</h4>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="w3-card-4 w3-container w3-orange w3-padding w3-center w3-round">
                <h1><i class="fas fa-clock"></i><br />We're not yet cooking anything.</h1>
                <p>You came too early! Come back after a few minutes.</p>
            </div>
            {% endif %}
            {% if orders_count %}
            <div class="w3-card-4 w3-container w3-blue w3-padding w3-center w3-round">
                <h3>
                    We currently have {{ orders_count }} order{% if orders_count > 1 %}s{% endif %}. Order now!
                </h3>
            </div>
            {% endif %}
        </div>
        {% if request.session.orders %}
        <div class="w3-content w3-container w3-white w3-round" style="margin-top: 50px;">
            <h3><i class="fas fa-clipboard-list"></i> These are the orders from this device.</h3>
            <p class="w3-small">The orders made from this device are only displaying here and on the real-time admin
                page. Please do not close this tab and your browser if you want to keep track of the orders' status. The
                orders cannot be edited by you. Only the admins have the authorization to modify them. You,
                however, can ask the admins to change it for you when you're at the canteen already.</p>
            <p class="w3-center w3-opacity" id="spinner"><i class="fas fa-spinner w3-spin"></i> Loading updates...</p>
            <div id="orders">
            </div>
        </div>
        <script>
            var protocol = location.protocol == 'https:' ? 'wss://' : 'ws://';
            var reportSocket = new ReconnectingWebSocket(
                protocol + location.host +
                '/ws/update/');
            var orders = $('#orders');
            function structureOrders() {
                var ul = $('<ul class="w3-ul"></ul>');
                $.get("{% url 'canteen:json-customer-orders' %}", function (data, status) {
                    if (status == 'success') {
                        console.log('Updating the orders...');
                        if (!(data.length)) location.reload();
                        for (var i in data) {
                            if (data[i].served) {
                                ul.append($(
                                    '<li class="served w3-round"><i class="fas fa-check-circle w3-text-green"></i> <span>The order of ' + data[i].name + ', which was ' + data[i].dish.name + ', has been served already.</span></li>'
                                ));
                            } else {
                                if (data[i].ready) {
                                    ul.append($(
                                        '<li class="ready w3-round"><i class="fas fa-exclamation-circle w3-text-yellow"></i> <span>The order of ' + data[i].name + ", which is " + data[i].dish.name + ' with the order quantity of ' + data[i].dish.count + ' and priced as â‚±' + data[i].dish.price + ' is now ready to be served.</span></li > '
                                    ));
                                } else {
                                    ul.append($(
                                        '<li class="notReady w3-round"><i class="fas fa-times-circle w3-text-red"></i> <span>The order of ' + data[i].name + ", which is " + data[i].dish.name + ' with the order quantity of ' + data[i].dish.count + ' and priced as â‚±' + data[i].dish.price + ' is not yet ready.</span></li > '
                                    ));
                                }
                            }
                        }
                    }
                });
                orders.html(ul);
                $('#spinner').slideUp();
            }

            $(document).ready(function () {
                setInterval(location.reload, 300000);
                structureOrders();
                reportSocket.onmessage = function (e) {
                    $('#spinner').slideDown();
                    structureOrders();
                };
            })
        </script>
        {% endif %}
    </article>

    {% include 'canteen/footer.html' with canShare=True %}

</body>

</html>