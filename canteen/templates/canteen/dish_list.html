{% load static %}

<!DOCTYPE html>
<html>

<head>
    <title>ESTI Canteen Ordering System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    {% with 'https://esticanteen.pythonanywhere.com' as domain %}
    <meta name="og:title" content="ESTI Canteen Ordering System" />
    <meta name="twitter:title" content="ESTI Canteen Ordering System" />
    <meta name="description" content="Where you can find the best delicacies." />
    <meta name="twitter:description" content="Where you can find the best delicacies." />
    <meta name="og:description" content="Where you can find the best delicacies." />
    <meta name="twitter:image" content="{{ domain }}{% static 'canteen/bg.jpg' %}" />
    <meta name="og:image" content="{{ domain }}{% static 'canteen/bg.jpg' %}" />
    {% endwith %}

    <meta name="google-site-verification" content="8KRj0scCxCiNcxjPWlApSIIXTOipt2bT3WcUeVsqv80" />
    <link rel="stylesheet" href="{% static 'canteen/w3.css' %}" />
    <link rel="icon" href="{% static 'canteen/esti_icon.png' %}" type="image/x-icon" />
    <script rel="script" src="{% static 'canteen/jquery.min.js' %}"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
        integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto+Slab&display=swap);

        html,
        body {
            height: 100%;
            padding: 0px;
            margin: 0px;
        }

        header h1 {
            font-size: 50px;
        }

        header {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: url("{% static 'canteen/bg.jpg' %}") no-repeat center fixed;
            background-size: cover;
            overflow: hidden;
        }

        header>div {
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
        }

        header h1 {
            line-height: 1.32em;
            font-family: 'Roboto Slab', serif;
            font-weight: bolder;
        }

        header>div div:nth-child(2) {
            width: 40%;
        }

        header h1 span,
        header p span {
            background: rgba(76, 175, 79, 0.486);
        }

        footer {
            background: linear-gradient(to bottom right, #2196F3, violet);
        }

        footer h1 {
            font-family: 'Roboto Slab', serif;
            font-weight: normal;
        }

        .served,
        .ready,
        .notReady {
            display: flex;
            align-items: center;
            text-align: left;
            margin-bottom: 8px;
        }

        .served i,
        .ready i,
        .notReady i {
            padding-right: 16px;
        }

        .served {
            background: #ddffdd;
            border-left: 3px solid #4CAF50;
        }

        .ready {
            background: #ffffcc;
            border-left: 3px solid #d2be0e;
        }

        .notReady {
            background: #ffdddd;
            border-left: 3px solid #f44336;
        }

        .share-links {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .share-links a {
            width: 38px;
            height: 38px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            border-radius: 100%;
            margin: 3px 5px 3px 5px;
            transition: 0.5s;
            text-decoration: none;
            font-size: 30px;
        }

        .share-links a:hover {
            font-size: 50px;
        }

        @media (max-width:768px) {
            header h1 {
                font-size: 50px;
            }

            header>div {
                flex-direction: column;
            }

            header>div div:nth-child(2) {
                width: 100%;
            }

            header {
                text-align: center;
            }

            #logo {
                width: 150px;
                height: 150px;
            }

            footer h1 {
                font-size: 25px;
            }
        }

        @media (max-width:992px) and (min-width:601px) {
            header h1 {
                font-size: 70px;
            }

            header {
                text-align: center;
            }

            #logo {
                width: 250px;
                height: 250px;
            }
        }

        @media (min-width:993px) {
            header h1 {
                font-size: 90px;
            }
        }
    </style>
</head>

<body>
    <header class="w3-animate-opacity">
        <div class="w3-container w3-animate-zoom">
            <div>
                <img id="logo" src="{% static 'canteen/esti_square.png' %}" width="350" height="350" />
            </div>
            <div>
                <h1 class="w3-text-white"><span>Welcome to ESTI's Canteen!</span></h1>
                <p class="w3-large w3-text-white"><span>Where you can find the best delicacies.</span>
                </p>
                <a href="#article" class="w3-button w3-padding w3-round-xxlarge w3-purple">
                    <i class="fas fa-clipboard-list"></i> See the menu</a>
            </div>
        </div>
    </header>

    <article id="article" class="w3-container w3-padding-32 w3-margin w3-animate-opacity">
        <div class="w3-content">
            {% if dishes %}
            <h2><i class="fas fa-clipboard-list"></i> Our menu for today!</h2>
            {% include 'canteen/dishes.html' with dishes=dishes %}
            {% else %}
            <div class="w3-card-4 w3-container w3-orange w3-padding w3-center w3-round">
                <h1><i class="fas fa-clock"></i><br />We're not yet cooking anything.</h1>
                <p>You came too early! Come back after a few minutes.</p>
            </div>
            {% endif %}
            {% if orders_count %}
            <div class="w3-card-4 w3-container w3-blue w3-padding w3-center w3-round">
                <h3>
                    We currently have {{ orders_count }} order{% if orders_count > 1 %}s{% endif %}. Order now!
                </h3>
            </div>
            {% endif %}
        </div>
        {% if request.session.orders %}
        <div class="w3-content" style="margin-top: 50px;">
            <h3><i class="fas fa-clipboard-list"></i> These are the orders from this device.</h3>
            <p class="w3-small">Your orders are only displaying on this device and on the real-time orders of
                the admin site. Once you submit your order, you can no longer change it. This constraint is implemented
                to not confuse the staff when packing the orders. However, if you're at the
                canteen already, you can politely ask the staff to change it for you.</p>
            <div id="orders">
            </div>
        </div>
        <script>
            var protocol = location.protocol == 'https:' ? 'wss://' : 'ws://';
            var reportSocket = new WebSocket(
                protocol + location.host +
                '/ws/update/');
            var orders = $('#orders');
            function structureOrders() {
                var ul = $('<ul class="w3-ul"></ul>');
                $.get("{% url 'canteen:json-customer-orders' %}", function (data, status) {
                    if (status == 'success') {
                        console.log('Updating the orders...');
                        if (!(data.length)) location.reload();
                        for (var i in data) {
                            if (data[i].served) {
                                ul.append($(
                                    '<li class="served"><i class="fas fa-check-circle w3-text-green"></i> <span>' + data[i].name + "'s order \"" + data[i].dish.name + '" with the order quantity of ' + data[i].dish.count + ' and priced as ₱' + data[i].dish.price + ' has been served already.</span></li>'
                                ));
                            } else {
                                if (data[i].ready) {
                                    ul.append($(
                                        '<li class="ready"><i class="fas fa-exclamation-circle w3-text-yellow"></i> <span>' + data[i].name + "'s order \"" + data[i].dish.name + '" with the order quantity of ' + data[i].dish.count + ' and priced as ₱' + data[i].dish.price + ' is now ready to be served.</span></li > '
                                    ));
                                } else {
                                    ul.append($(
                                        '<li class="notReady"><i class="fas fa-times-circle w3-text-red"></i> <span>' + data[i].name + "'s order \"" + data[i].dish.name + '" with the order quantity of ' + data[i].dish.count + ' and priced as ₱' + data[i].dish.price + ' is not yet ready.</span></li > '
                                    ));
                                }
                            }
                        }
                    }
                });
                orders.html(ul);
            }
            structureOrders();
            reportSocket.onmessage = function (e) {
                setTimeout(structureOrders, 500);
            };

            //reportSocket.onerror = function (e) {
            //    location.reload();
            //}
        </script>
        {% endif %}
    </article>

    <footer class="w3-container w3-center w3-padding-64">
        <div class="w3-margin-bottom share-links">
            <div class="w3-margin-top share-links">
                {% with "https://esticanteen.pythonanywhere.com" as domain %}
                <a href="https://web.facebook.com/sharer/sharer.php?u={{ domain }}{% url 'canteen:home' %}"
                    title="Share on Facebook!">
                    <i class="fab fa-facebook"></i></a>
                <a href="https://www.twitter.com/share?url={{ domain }}{% url 'canteen:home' %}"
                    title="Share on Twitter!">
                    <i class="fab fa-twitter"></i></a>
                <a title="Share on Linkedin!"
                    href="https://www.linkedin.com/shareArticle/?mini=true&url={{ domain }}{% url 'canteen:home' %}">
                    <i class="fab fa-linkedin"></i></a>
                <a title="Share on Telegram!"
                    href="https://telegram.me/share/?url={{ domain }}{% url 'canteen:home' %}">
                    <i class="fab fa-telegram"></i></a>
                <a title="Share on Whatsapp!"
                    href="https://api.whatsapp.com/send?text={{ domain }}{% url 'canteen:home' %}">
                    <i class="fab fa-whatsapp"></i></a>
                <a title="Share on Pinterest!"
                    href="https://www.pinterest.ph/pin/find/?url={{ domain }}{% url 'canteen:home' %}">
                    <i class="fab fa-pinterest"></i></a>
                <a title="Share on Reddit!" href="https://reddit.com/submit?url={{ domain }}{% url 'canteen:home' %}">
                    <i class="fab fa-reddit"></i></a>
                {% endwith %}
            </div>
        </div>
        <div class="w3-content">
            <h1 class="w3-text-white">
                <i class="fas fa-quote-left"></i>
                If more of us valued food and cheer and song above hoarded gold, it
                would be a merrier world.
                <i class="fas fa-quote-right"></i>
            </h1>
            <p class="w3-text-white">― J.R.R. Tolkien</p>
        </div>
        <a href="{% url 'canteen:manage' %}" class="w3-button w3-margin-top w3-round-xxlarge w3-purple">
            <i class="fas fa-tools"></i> Manage</a>
        <a href="{% url 'canteen:feedback' %}" class="w3-button w3-margin-top w3-round-xxlarge w3-purple">
            <i class="fas fa-feather-alt"></i> Feedback</a>
        <a href="{% url 'canteen:about' %}" class="w3-button w3-margin-top w3-round-xxlarge w3-purple">
            <i class="fas fa-info-circle"></i> About</a>
        <a href="{% url 'canteen:privacy-policy' %}" class="w3-button w3-margin-top w3-round-xxlarge w3-purple">
            <i class="fas fa-info-circle"></i> Privacy Policy</a>
        <p class="w3-text-white w3-opacity"><a href="https://sadian.herokuapp.com">@Sadian</a></p>
    </footer>
</body>

</html>