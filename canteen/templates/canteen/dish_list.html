{% load static %}

<!DOCTYPE html>
<html>

<head>
    <title>ESTI Canteen Ordering System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="google-site-verification" content="FTZWO1Qq5IIiyHFq8P2FnK9nLlSAl2Ftgjtc8ppr5Is" />

    {% with 'https://esticanteen.herokuapp.com' as domain %}
    <meta name="og:title" content="ESTI Canteen Ordering System" />
    <meta name="twitter:title" content="ESTI Canteen Ordering System" />
    <meta name="description" content="Where you can find the best delicacies." />
    <meta name="twitter:description" content="Where you can find the best delicacies." />
    <meta name="og:description" content="Where you can find the best delicacies." />
    <meta name="twitter:image" content="{{ domain }}{% static 'canteen/bg.jpg' %}" />
    <meta name="og:image" content="{{ domain }}{% static 'canteen/bg.jpg' %}" />
    {% endwith %}

    <meta name="google-site-verification" content="8KRj0scCxCiNcxjPWlApSIIXTOipt2bT3WcUeVsqv80" />
    <link rel="stylesheet" href="{% static 'canteen/w3.css' %}" />
    <link rel="icon" href="{% static 'canteen/esti_icon.png' %}" type="image/x-icon" />
    <script rel="script" src="{% static 'canteen/jquery.min.js' %}"></script>
    <script rel="script" src="{% static 'canteen/reconnecting-websocket.min.js' %}"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
        integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto+Slab&display=swap);

        html,
        body {
            height: 100%;
            padding: 0px;
            margin: 0px;
        }

        body {
            background: url("{% static 'canteen/home-bg.jpg' %}");
        }

        header {
            height: 100%;
            background: url("{% static 'canteen/canteen-bg.jpg' %}") no-repeat center fixed;
            background-size: cover;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .grid-cont {
            display: grid;
            grid-template-columns: 2fr 3fr;
            grid-template-areas:
                "logo text"
                "bttn bttn";
            padding-left: 100px;
            padding-right: 100px;
        }

        .logo {
            grid-area: logo;
            align-self: center;
            justify-self: end;
        }

        .text {
            grid-area: text;
            align-self: center;
            justify-self: start;
        }

        .bttn {
            grid-area: bttn;
            align-self: start;
            justify-self: center;
        }

        header h1 {
            line-height: 1.32em;
            font-family: 'Roboto Slab', serif;
            font-weight: bolder;
        }

        header h1 span,
        header p span {
            background: rgba(0, 0, 0, 0.589);
        }

        .served,
        .ready,
        .notReady {
            display: flex;
            align-items: center;
            text-align: left;
            margin-bottom: 8px;
        }

        .served i,
        .ready i,
        .notReady i {
            padding-right: 16px;
        }

        .served {
            background: #ddffdd;
            border-left: 3px solid #4CAF50;
        }

        .ready {
            background: #ffffcc;
            border-left: 3px solid #d2be0e;
        }

        .notReady {
            background: #ffdddd;
            border-left: 3px solid #f44336;
        }

        @media (max-width:768px) {

            /* Small */
            header h1 {
                font-size: 50px;
            }

            .grid-cont {
                grid-template-areas:
                    "logo logo"
                    "text text"
                    "bttn bttn";
                padding-left: 10px;
                padding-right: 10px;
            }

            .logo,
            .text,
            .bttn {
                justify-self: center;
                text-align: center;
            }

            #logo {
                width: 150px;
                height: 150px;
            }

            footer h1 {
                font-size: 25px;
            }
        }

        @media (max-width:992px) and (min-width:601px) {

            /* Medium */
            header h1 {
                font-size: 70px;
            }

            .grid-cont {
                grid-template-areas:
                    "logo text"
                    "bttn bttn";
                padding-left: 10px;
                padding-right: 10px;
            }

            .text {
                text-align: left;
            }

            #logo {
                width: 250px;
                height: 250px;
            }
        }

        @media (min-width:993px) {

            /* Large */
            header h1 {
                font-size: 90px;
            }
        }
    </style>
</head>

<body>

    <header class="w3-animate-opacity">
        <div class="grid-cont">
            <div class="logo">
                <img id="logo" src="{% static 'canteen/esti_square.png' %}" width="350" height="350" />
            </div>
            <div class="text">
                <h1 class="w3-text-light-green"><span>Welcome to the ESTI Canteen!</span></h1>
                <p class="w3-large w3-text-white"><span>Where you can find the best delicacies.</span>
                </p>
            </div>
            <div class="bttn">
                <a href="#article" class="w3-button w3-padding w3-round-xxlarge w3-light-green">
                    <i class="fas fa-clipboard-list"></i> See the menu</a>
            </div>
        </div>
    </header>

    <article id="article" class="w3-container w3-padding-32 w3-margin w3-animate-opacity">
        <div class="w3-content">
            {% if dishes %}
            <h2><i class="fas fa-clipboard-list"></i> Our menu for today!</h2>
            {% include 'canteen/dishes.html' with dishes=dishes %}
            {% else %}
            <div class="w3-card-4 w3-container w3-orange w3-padding w3-center w3-round">
                <h1><i class="fas fa-clock"></i><br />We're not yet cooking anything.</h1>
                <p>You came too early! Come back after a few minutes.</p>
            </div>
            {% endif %}
            {% if orders_count %}
            <div class="w3-card-4 w3-container w3-blue w3-padding w3-center w3-round">
                <h3>
                    We currently have {{ orders_count }} order{% if orders_count > 1 %}s{% endif %}. Order now!
                </h3>
            </div>
            {% endif %}
        </div>
        {% if request.session.orders %}
        <div class="w3-content w3-container w3-white" style="margin-top: 50px;">
            <h3><i class="fas fa-clipboard-list"></i> These are the orders from this device.</h3>
            <p class="w3-small">The orders made from this device are only displaying here and on the real-time admin
                page. Please do not close this tab and your browser if you want to keep track of the orders' status. The
                orders cannot be edited by you. Only the admins have the authorization to modify them. You,
                however, can ask the admins to change it for you when you're at the canteen already.</p>
            <p class="w3-center w3-opacity" id="spinner"><i class="fas fa-spinner w3-spin"></i> Loading updates...</p>
            <div id="orders">
            </div>
        </div>
        <script>
            var protocol = location.protocol == 'https:' ? 'wss://' : 'ws://';
            var reportSocket = new ReconnectingWebSocket(
                protocol + location.host +
                '/ws/update/');
            var orders = $('#orders');
            function structureOrders() {
                var ul = $('<ul class="w3-ul"></ul>');
                $.get("{% url 'canteen:json-customer-orders' %}", function (data, status) {
                    if (status == 'success') {
                        console.log('Updating the orders...');
                        if (!(data.length)) location.reload();
                        for (var i in data) {
                            if (data[i].served) {
                                ul.append($(
                                    '<li class="served"><i class="fas fa-check-circle w3-text-green"></i> <span>The order of ' + data[i].name + ', which was ' + data[i].dish.name + ', has been served already.</span></li>'
                                ));
                            } else {
                                if (data[i].ready) {
                                    ul.append($(
                                        '<li class="ready"><i class="fas fa-exclamation-circle w3-text-yellow"></i> <span>The order of ' + data[i].name + ", which is " + data[i].dish.name + ' with the order quantity of ' + data[i].dish.count + ' and priced as ₱' + data[i].dish.price + ' is now ready to be served.</span></li > '
                                    ));
                                } else {
                                    ul.append($(
                                        '<li class="notReady"><i class="fas fa-times-circle w3-text-red"></i> <span>The order of ' + data[i].name + ", which is " + data[i].dish.name + ' with the order quantity of ' + data[i].dish.count + ' and priced as ₱' + data[i].dish.price + ' is not yet ready.</span></li > '
                                    ));
                                }
                            }
                        }
                    }
                });
                orders.html(ul);
                $('#spinner').slideUp();
            }
            structureOrders();
            reportSocket.onmessage = function (e) {
                $('#spinner').slideDown();
                structureOrders();
            };

            setInterval(location.reload, 300000);
        </script>
        {% endif %}
    </article>

    {% include 'canteen/footer.html' with canShare=True %}
</body>

</html>